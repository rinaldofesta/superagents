# FastAPI Skill

> Modern, fast Python web framework for building APIs with automatic docs

## When to Use

Use this skill when building REST APIs with FastAPI, working with Pydantic models, or implementing async endpoints.

## Key Concepts

| Concept | Description | Use Case |
|---------|-------------|----------|
| Path Operations | Route decorators (@app.get, etc.) | Define endpoints |
| Pydantic Models | Data validation and serialization | Request/response schemas |
| Dependency Injection | Reusable components | Auth, DB sessions |
| Async Support | Native async/await | High performance I/O |
| Auto Documentation | OpenAPI/Swagger UI | /docs, /redoc |

## Basic Setup

```python
from fastapi import FastAPI, HTTPException, Depends
from pydantic import BaseModel
from typing import Optional

app = FastAPI(title="My API", version="1.0.0")

# Pydantic models for validation
class ItemCreate(BaseModel):
    name: str
    description: Optional[str] = None
    price: float

class Item(ItemCreate):
    id: int

    class Config:
        from_attributes = True  # For ORM integration

# Basic endpoints
@app.get("/")
async def root():
    return {"message": "Hello World"}

@app.get("/items/{item_id}")
async def get_item(item_id: int) -> Item:
    item = await db.get_item(item_id)
    if not item:
        raise HTTPException(status_code=404, detail="Item not found")
    return item

@app.post("/items/", status_code=201)
async def create_item(item: ItemCreate) -> Item:
    return await db.create_item(item)
```

## Dependency Injection

```python
from fastapi import Depends, Header, HTTPException
from fastapi.security import HTTPBearer

security = HTTPBearer()

# Database session dependency
async def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

# Auth dependency
async def get_current_user(
    token: str = Depends(security),
    db: Session = Depends(get_db)
) -> User:
    user = await verify_token(token.credentials, db)
    if not user:
        raise HTTPException(status_code=401, detail="Invalid token")
    return user

# Use in endpoints
@app.get("/users/me")
async def get_me(user: User = Depends(get_current_user)):
    return user
```

## Query & Path Parameters

```python
from fastapi import Query, Path

@app.get("/items/")
async def list_items(
    skip: int = Query(default=0, ge=0),
    limit: int = Query(default=10, le=100),
    search: Optional[str] = Query(default=None, min_length=1)
):
    return await db.get_items(skip=skip, limit=limit, search=search)

@app.get("/items/{item_id}")
async def get_item(
    item_id: int = Path(..., gt=0, description="The item ID")
):
    return await db.get_item(item_id)
```

## Error Handling

```python
from fastapi import HTTPException
from fastapi.responses import JSONResponse
from fastapi.exceptions import RequestValidationError

# Raise HTTP exceptions
@app.get("/items/{item_id}")
async def get_item(item_id: int):
    if item_id not in items:
        raise HTTPException(
            status_code=404,
            detail="Item not found",
            headers={"X-Error": "Not found"}
        )
    return items[item_id]

# Custom exception handler
@app.exception_handler(RequestValidationError)
async def validation_exception_handler(request, exc):
    return JSONResponse(
        status_code=422,
        content={"detail": exc.errors(), "body": exc.body}
    )
```

## Router Organization

```python
# routers/items.py
from fastapi import APIRouter

router = APIRouter(prefix="/items", tags=["items"])

@router.get("/")
async def list_items():
    return []

@router.get("/{item_id}")
async def get_item(item_id: int):
    return {"id": item_id}

# main.py
from fastapi import FastAPI
from routers import items, users

app = FastAPI()
app.include_router(items.router)
app.include_router(users.router)
```

## Pitfalls

- Use `async def` for I/O operations, `def` for CPU-bound
- Pydantic v2 uses `model_validate()` not `parse_obj()`
- Don't forget `await` for async database calls
- Use `response_model` to control output schema
- Set CORS middleware for frontend integration

## Context7

```
mcp__context7__resolve-library-id with "fastapi"
mcp__context7__query-docs for specific FastAPI questions
```

---

Generated by SuperAgents
