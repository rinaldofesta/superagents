# Vitest Skill

> Fast, Vite-native testing framework with Jest compatibility

## When to Use

Use this skill when writing unit tests, integration tests, or component tests with Vitest.

## Key Concepts

| Concept | Description | Use Case |
|---------|-------------|----------|
| describe/it | Test organization | Group related tests |
| expect | Assertions | Verify outcomes |
| vi | Mock utilities | Spies, stubs, timers |
| beforeEach | Setup hooks | Test isolation |

## Basic Test Structure

```typescript
import { describe, it, expect, beforeEach, afterEach } from 'vitest'

describe('Calculator', () => {
  let calculator: Calculator

  beforeEach(() => {
    calculator = new Calculator()
  })

  afterEach(() => {
    // Cleanup
  })

  it('should add two numbers', () => {
    expect(calculator.add(2, 3)).toBe(5)
  })

  it('should throw on division by zero', () => {
    expect(() => calculator.divide(1, 0)).toThrow('Division by zero')
  })
})
```

## Common Assertions

```typescript
// Equality
expect(value).toBe(5)                    // Strict equality
expect(obj).toEqual({ a: 1 })            // Deep equality
expect(obj).toStrictEqual({ a: 1 })      // Strict deep equality

// Truthiness
expect(value).toBeTruthy()
expect(value).toBeFalsy()
expect(value).toBeNull()
expect(value).toBeUndefined()
expect(value).toBeDefined()

// Numbers
expect(value).toBeGreaterThan(5)
expect(0.1 + 0.2).toBeCloseTo(0.3)

// Strings
expect(str).toMatch(/pattern/)
expect(str).toContain('substring')

// Arrays/Objects
expect(arr).toContain(item)
expect(obj).toHaveProperty('key', 'value')
expect(obj).toMatchObject({ partial: 'match' })

// Exceptions
expect(() => fn()).toThrow('error message')
expect(() => fn()).toThrow(ErrorClass)

// Async
await expect(promise).resolves.toBe('value')
await expect(promise).rejects.toThrow('error')
```

## Mocking

```typescript
import { vi } from 'vitest'

// Mock function
const mockFn = vi.fn()
mockFn.mockReturnValue(42)
mockFn.mockResolvedValue({ data: [] })

// Spy on method
const spy = vi.spyOn(object, 'method')
expect(spy).toHaveBeenCalledWith('arg')
expect(spy).toHaveBeenCalledTimes(1)

// Mock module
vi.mock('./api', () => ({
  fetchData: vi.fn().mockResolvedValue({ items: [] })
}))

// Mock timers
vi.useFakeTimers()
vi.advanceTimersByTime(1000)
vi.useRealTimers()

// Reset mocks
vi.clearAllMocks()  // Clear call history
vi.resetAllMocks()  // Reset to initial state
vi.restoreAllMocks() // Restore original implementations
```

## Config

```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config'

export default defineConfig({
  test: {
    globals: true,
    environment: 'node', // or 'jsdom' for browser
    coverage: {
      provider: 'v8',
      reporter: ['text', 'html'],
    },
  },
})
```

## Pitfalls

- Clear mocks between tests with `beforeEach`
- Use `toStrictEqual` for exact object matching
- Mock timers before the code that uses them
- Don't forget to restore mocks in afterEach

## Context7

```
mcp__context7__resolve-library-id with "vitest"
mcp__context7__query-docs for specific Vitest questions
```

---

Generated by SuperAgents
